<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bonnie SIRA ‚Äî Prototipo (Entradas, Salidas + Carro Webpay)</title>
  <style>
    :root{
      --lav:#7a77ff;
      --lav-2:#a6a3ff;
      --cel:#7fd3ff;
      --bg:#f6f7ff;
      --card:#ffffff;
      --ink:#1f2230;
      --muted:#6b6f86;
      --line:#eceefe;
      --radius:16px;
      --shadow:0 10px 30px rgba(35,38,90,.08);
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    body{margin:0;background:var(--bg);color:var(--ink);}
    a{color:inherit;text-decoration:none;}
    header{
      position:sticky;top:0;z-index:50;
      background:linear-gradient(90deg,var(--lav),var(--cel));
      color:#fff;padding:14px 18px;box-shadow:0 6px 20px rgba(0,0,0,.12);
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px;}
    .paw{
      width:34px;height:34px;border-radius:10px;background:rgba(255,255,255,.18);
      display:grid;place-items:center;font-size:18px;
      backdrop-filter: blur(4px);
    }
    nav{display:flex;gap:8px;flex-wrap:wrap;}
    nav button{
      border:0;background:rgba(255,255,255,.14);color:#fff;
      padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700;
      transition:.2s;display:flex;align-items:center;gap:6px;
    }
    nav button.active{background:#fff;color:var(--lav);}
    nav button:hover{transform:translateY(-1px);background:rgba(255,255,255,.22);}

    .wrap{max-width:1100px;margin:18px auto;padding:0 14px 60px;}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;}
    .card{
      background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;
    }
    h2{font-size:18px;margin:0 0 10px;}
    h3{font-size:15px;margin:6px 0;color:#343853;}
    .muted{color:var(--muted);font-size:13px;}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;
      background:#f2f3ff;color:#40446a;font-weight:700;border:1px solid var(--line);}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
    .spacer{height:8px;}
    .btn{
      border:0;background:var(--lav);color:#fff;padding:9px 12px;border-radius:12px;cursor:pointer;font-weight:800;
      transition:.15s;box-shadow:0 6px 14px rgba(122,119,255,.35);
    }
    .btn:hover{transform:translateY(-1px);filter:saturate(1.05);}
    .btn.secondary{background:#eef0ff;color:#3a3f63;box-shadow:none;border:1px solid var(--line);}
    .btn.ghost{background:transparent;color:var(--lav);border:2px solid var(--lav);box-shadow:none;}
    .btn.small{padding:6px 9px;border-radius:10px;font-size:12px;}
    .btn:disabled{opacity:.6;cursor:not-allowed;transform:none;}

    .product{
      display:flex;gap:12px;align-items:center;border:1px dashed var(--line);
      padding:10px;border-radius:14px;background:#fbfbff;
    }
    .pimg{
      width:62px;height:62px;border-radius:14px;
      background:linear-gradient(160deg,#fff,#eef0ff);
      display:grid;place-items:center;font-size:26px;
      border:1px solid var(--line);
    }
    .price{font-weight:900;}
    .tag{font-size:11px;font-weight:800;padding:3px 7px;border-radius:9px;background:#e9fff2;color:#0a7d3b;border:1px solid #c9f0d8;}
    .tag.warn{background:#fff7e9;color:#915f00;border-color:#f2d8a8;}

    table{width:100%;border-collapse:collapse;}
    th,td{padding:9px;border-bottom:1px solid var(--line);font-size:14px;}
    th{color:var(--muted);text-align:left;font-weight:800;}
    .right{text-align:right;}

    input,select,textarea{
      width:100%;padding:9px;border-radius:12px;border:1px solid #dfe2fb;background:#fcfcff;
      outline:none;transition:.15s;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--lav-2);box-shadow:0 0 0 4px rgba(122,119,255,.12);}

    section.hidden{display:none;}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(15,16,30,.5);z-index:99;}
    .dialog{background:white;width:min(560px,92vw);border-radius:18px;padding:14px;border:1px solid var(--line);box-shadow:0 20px 60px rgba(0,0,0,.25);}
    .dialog header{position:unset;background:transparent;color:var(--ink);box-shadow:none;padding:0;display:flex;justify-content:space-between;}
    .x{border:0;background:transparent;font-size:22px;cursor:pointer;}

    footer{color:var(--muted);font-size:12px;text-align:center;margin-top:14px;}

    @media (max-width:800px){ .grid{grid-template-columns:repeat(6,1fr);} }
    @media (max-width:520px){
      .grid{grid-template-columns:repeat(2,1fr);}
      nav{gap:6px;}
    }
  </style>
</head>
<body>

<div id="loginScreen" style="
  position:fixed; inset:0; background:#f6f7ff;
  display:flex; align-items:center; justify-content:center;
  z-index:9999;
">
  <div style="background:white; padding:24px; border-radius:16px; width:300px;
              box-shadow:0 10px 40px rgba(0,0,0,.1); border:1px solid #eceefe;">
    <h2 style="text-align:center; margin-top:0;">Ingreso al sistema</h2>

    <label>Selecciona tu rol</label>
    <select id="roleSelect" style="width:100%; padding:10px; border-radius:12px; margin-bottom:16px;">
      <option value="adoptante">Adoptante</option>
      <option value="admin">Funcionario Refugio</option>
    </select>

    <button onclick="login()" style="
      width:100%; padding:10px; border-radius:12px; background:#7a77ff;
      color:white; font-weight:700; border:none; cursor:pointer;
    ">Ingresar</button>
  </div>
</div>


<header>
  <div class="brand">
    <div class="paw">üêæ</div>
    <div>
      <div>Bonnie SIRA</div>
      <div class="muted" style="color:#eef;">Refugio & Adopciones</div>
    </div>
  </div>
  <nav>
    <button id="tab-home" class="active" onclick="show('home')">üè† Inicio</button>
    <button id="tab-entradas" onclick="show('entradas')">üì• Formulario de Adopci√≥n</button>
    <button id="tab-tienda" onclick="show('tienda')">üõçÔ∏è Tienda/Donar</button>
    <button id="tab-carro" onclick="show('carro')">üß∫ Carro <span id="badge" class="chip" style="background:#fff;color:var(--lav);">0</span></button>
    <button id="tab-salidas" onclick="show('salidas')">üìÑ Salidas</button>
    <button class="btn secondary" onclick="logout()">Cerrar sesi√≥n</button>
  </nav>
</header>

<div class="wrap">

  <!-- HOME -->
  <section id="home" class="card">
    <h2>Bienvenida</h2>
    <p class="muted">Prototipo de entradas y salidas del sistema Bonnie SIRA + carro de compras con integraci√≥n Webpay simulada.</p>
    <div class="spacer"></div>
    <div class="grid">
      <div class="card" style="grid-column:span 4;">
        <h3>Adopta con confianza</h3>
        <p class="muted">Solicita adopci√≥n, agenda visita y recibe tu contrato digital.</p>
        <div class="row"><span class="chip">Comprobante</span><span class="chip">Contrato</span></div>
        <div class="spacer"></div>
        <button class="btn" onclick="show('salidas')">Ver documentos</button>
      </div>
      <div class="card" style="grid-column:span 4;">
        <h3>Cuida su salud</h3>
        <p class="muted">Ficha cl√≠nica, vacunaci√≥n y alertas de control.</p>
        <div class="row"><span class="chip">Hoja vacunaci√≥n</span><span class="chip">Ficha cl√≠nica</span></div>
        <div class="spacer"></div>
        <button class="btn secondary" onclick="show('salidas')">Ver salidas cl√≠nicas</button>
      </div>
      <div class="card" style="grid-column:span 4;">
        <h3>Apoya al refugio</h3>
        <p class="muted">Compra insumos o dona con Webpay. Recibes boleta por mail.</p>
        <div class="row"><span class="chip">Carro</span><span class="chip">Webpay</span></div>
        <div class="spacer"></div>
        <button class="btn ghost" onclick="show('tienda')">Ir a tienda</button>
      </div>
    </div>
  </section>

  <!-- ENTRADAS (FUNCIONAL) -->
  <section id="entradas" class="hidden card">
    <h2>Formulario de Adopci√≥n</h2>
    <div class="grid">
      <div class="card" style="grid-column:span 6;">
        <h3>Datos del adoptante</h3>
        <label>Nombre completo</label>
        <input id="inNombre" placeholder="Ej: B√°rbara Valenzuela" required />
        <label>RUT</label>
        <input id="inRut" placeholder="xx.xxx.xxx-x" required />
        <label>Correo electr√≥nico</label>
        <input id="inCorreo" type="email" placeholder="ejemplo@correo.cl" required />
        <label>Tel√©fono</label>
        <input id="inTelefono" type="tel" placeholder="+56 9 xxxx xxxx" />

        <h3>Datos del animal</h3>
        <label>Nombre del animal</label>
        <input id="inAnimalNombre" placeholder="Ej: Bonnie" />
        <label>ID / Microchip</label>
        <input id="inMicrochip" placeholder="Opcional" />

        <h3>Proceso</h3>
        <label>Tipo de solicitud</label>
        <select id="inTipoSolicitud">
          <option value="adopcion">Adopci√≥n</option>
          <option value="visita">Visita domiciliaria</option>
          <option value="transito">Hogar temporal</option>
        </select>
        <label>Fecha propuesta de visita / entrega</label>
        <input id="inFecha" type="date" />
        <label>Observaciones</label>
        <textarea id="inObs" rows="3" placeholder="Informaci√≥n adicional"></textarea>

        <div class="spacer"></div>
        <div class="row">
          <button class="btn" onclick="registrarEntrada()">Registrar</button>
          <button class="btn secondary" onclick="limpiarEntrada()">Limpiar</button>
        </div>
      </div>

      <div class="card admin-only" style="grid-column:span 6;">
        <h3>√öltima entrada registrada</h3>
        <div id="entradaPreview" class="muted">
          No hay registros a√∫n.
        </div>

        <div class="card admin-only" style="grid-column:span 6;">
        <h3>Historial (mock)</h3>
        <div class="spacer"></div>
	<table>
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Adoptante</th>
              <th>Animal</th>
              <th>Tipo</th>
            </tr>
          </thead>
          <tbody id="tablaEntradas">
          </tbody>
        </table>

        <div class="spacer"></div>
        <button class="btn secondary" onclick="downloadEntradasJSON()">
          Descargar entradas (JSON)
        </button>
      </div>
    </div>
  </section>

  <!-- TIENDA / DONAR -->
  <section id="tienda" class="hidden">
    <div class="grid">
      <div class="card" style="grid-column:span 8;">
        <h2>Tienda solidaria üõçÔ∏è</h2>
        <p class="muted">Cat√°logo web con compras/donaciones.</p>
        <div class="spacer"></div>

        <div class="product">
          <div class="pimg">ü•´</div>
          <div style="flex:1;">
            <div class="row">
              <strong>Pack alimento 10kg</strong>
              <span class="tag">Insumo</span>
            </div>
            <div class="muted">Para perritos grandes.</div>
          </div>
          <div class="right">
            <div class="price">$24.990</div>
            <button class="btn small" onclick="addItem('Pack alimento 10kg', 24990)">Agregar</button>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="product">
          <div class="pimg">üíâ</div>
          <div style="flex:1;">
            <div class="row">
              <strong>Vacuna anual</strong>
              <span class="tag warn">Campa√±a</span>
            </div>
            <div class="muted">Aporta a la vacunaci√≥n masiva.</div>
          </div>
          <div class="right">
            <div class="price">$8.000</div>
            <button class="btn small" onclick="addItem('Aporte vacuna anual', 8000)">Agregar</button>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="product">
          <div class="pimg">üê∂</div>
          <div style="flex:1;">
            <div class="row">
              <strong>Cuota de adopci√≥n</strong>
              <span class="tag">Adopci√≥n</span>
            </div>
            <div class="muted">Cubre microchip + desparasitaci√≥n.</div>
          </div>
          <div class="right">
            <div class="price">$19.900</div>
            <button class="btn small" onclick="addItem('Cuota de adopci√≥n', 19900)">Agregar</button>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="product">
          <div class="pimg">üéÄ</div>
          <div style="flex:1;">
            <div class="row">
              <strong>Sticker Bonnie Berta (x5)</strong>
              <span class="tag">Merch</span>
            </div>
            <div class="muted">Pack de 5 stickers.</div>
          </div>
          <div class="right">
            <div class="price">$3.990</div>
            <button class="btn small" onclick="addItem('Sticker Bonnie Berta (x5)', 3990)">Agregar</button>
          </div>
        </div>

      </div>

      <div class="card" style="grid-column:span 4;">
        <h2>Resumen r√°pido</h2>
        <p class="muted">Pagas con Webpay simulado y generas boleta PDF.</p>
        <div class="spacer"></div>
        <div class="row">
          <button class="btn" onclick="show('carro')">Ir al carro</button>
          <button class="btn secondary" onclick="addDemo()">Agregar demo</button>
        </div>
      </div>
    </div>
  </section>

  <!-- CARRO -->
  <section id="carro" class="hidden">
    <div class="grid">
      <div class="card" style="grid-column:span 8;">
        <h2>Carro de compras</h2>
        <p class="muted">Checkout con Webpay (mock).</p>

        <table id="cartTable">
          <thead>
            <tr><th>√çtem</th><th class="right">Precio</th><th class="right">Cant.</th><th class="right">Subtotal</th><th></th></tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr><td colspan="3" class="right">Subtotal</td><td class="right" id="subtotal">$0</td><td></td></tr>
            <tr><td colspan="3" class="right">IVA 19%</td><td class="right" id="tax">$0</td><td></td></tr>
            <tr><td colspan="3" class="right"><strong>Total</strong></td><td class="right" id="total"><strong>$0</strong></td><td></td></tr>
          </tfoot>
        </table>

        <div class="spacer"></div>
        <div class="row">
          <button class="btn ghost" onclick="clearCart()">Vaciar carro</button>
          <button class="btn" onclick="openWebpay()">Pagar con Webpay</button>
        </div>
      </div>

      <div class="card" style="grid-column:span 4;">
        <h2>Datos del comprador</h2>
        <label>Nombre y Apellido</label>
        <input id="buyerName" placeholder="Ej: B√°rbara Valenzuela"/>
        <label>Email</label>
        <input id="buyerEmail" placeholder="ejemplo@correo.cl"/>
        <label>Tipo de aporte</label>
        <select id="purchaseType">
          <option value="donacion">Donaci√≥n</option>
          <option value="tienda">Compra tienda</option>
          <option value="adopcion">Cuota adopci√≥n</option>
        </select>
        <div class="spacer"></div>
        <p class="muted">Campos requeridos con validaci√≥n b√°sica.</p>
      </div>
    </div>
  </section>

  <!-- SALIDAS -->
  <section id="salidas" class="hidden card">
    <h2>Salidas del sistema</h2>
    <p class="muted">Documentos y reportes exportables (mock).</p>

    <div class="grid">
      <div class="card" style="grid-column:span 6;">
        <h3>Comprobante de adopci√≥n</h3>
        <p class="muted">Resumen de entrega + firma digital.</p>
        <div class="row">
          <button class="btn" onclick="previewDoc('Comprobante de adopci√≥n')">Vista previa</button>
          <button class="btn secondary"
            onclick="downloadPDF(
              'Comprobante_Adopcion.pdf',
              'Comprobante de adopci√≥n',
              [
                'Este documento funciona como evidencia formal del traspaso al nuevo hogar.',
                'Incluye datos esenciales que permiten al refugio llevar un control interno del caso,',
                'favoreciendo la supervisi√≥n posterior y disminuyendo riesgos de reincidencia o abandono.',
                '',
                'Elementos principales:',
                '‚Ä¢ Identificaci√≥n del animal.',
                '‚Ä¢ Datos del adoptante.',
                '‚Ä¢ Fecha y lugar de entrega.',
                '‚Ä¢ Responsable del refugio a cargo de la entrega.',
                '',
                'Firmas:',
                'Adoptante: ______________________________',
                'Refugio Bonnie SIRA: ____________________'
              ]
            )">
            Exportar PDF
          </button>
        </div>
      </div>

      <div class="card" style="grid-column:span 6;">
        <h3>Contrato de adopci√≥n</h3>
        <p class="muted">Cl√°usulas y obligaciones.</p>
        <div class="row">
          <button class="btn" onclick="previewDoc('Contrato de adopci√≥n')">Vista previa</button>
          <button class="btn secondary"
            onclick="downloadPDF(
              'Contrato_Adopcion.pdf',
              'Contrato de adopci√≥n',
              [
                'Folio: CA-000234',
                'Adoptante: Nombre Apellido (RUT xx.xxx.xxx-x)',
                'Animal: Bonnie (Canina, 2 a√±os, microchip 12345)',
                '',
                'Cl√°usulas principales:',
                '‚Ä¢ Cuidado responsable y controles veterinarios.',
                '‚Ä¢ Prohibici√≥n de abandono o maltrato.',
                '‚Ä¢ Seguimiento post-adopci√≥n por 6 meses.',
                '',
                'Firmas:',
                'Adoptante: ____________________',
                'Refugio: ______________________'
              ]
            )">
            Exportar PDF
          </button>
        </div>
      </div>

      <div class="card" style="grid-column:span 6;">
        <h3>Hoja de vacunaci√≥n</h3>
        <p class="muted">Aplicadas + pr√≥ximas dosis.</p>
        <div class="row">
          <button class="btn" onclick="previewDoc('Hoja de vacunaci√≥n')">Vista previa</button>
          <button class="btn secondary"
            onclick="downloadPDF(
              'Hoja_Vacunacion.pdf',
              'Hoja de Vacunaci√≥n',
              [
                'Registro de vacunaci√≥n del animal',
                '',
                'Este documento mantiene el historial de inmunizaci√≥n y controles preventivos.',
                'Favorece la continuidad cl√≠nica y facilita las consultas veterinarias posteriores.',
                'Adem√°s asegura que el animal cumple con las medidas sanitarias m√≠nimas requeridas.',
                '',
                'Incluye:',
                '‚Ä¢ Esquema de vacunas aplicadas.',
                '‚Ä¢ Pr√≥ximas fechas indicadas.',
                '‚Ä¢ Observaciones cl√≠nicas relevantes.',
                '‚Ä¢ Identificaci√≥n del veterinario o responsable.',
                '',
                'Este registro es fundamental para garantizar la salud del animal durante su traslado',
                'a su nuevo entorno familiar.'
              ]
            )">
            Exportar PDF
          </button>
        </div>
      </div>

      <div class="card admin-only" style="grid-column:span 6;">
        <h3>Informe visita domiciliaria</h3>
        <p class="muted">Checklist + evidencias.</p>
        <div class="row">
          <button class="btn" onclick="previewDoc('Informe visita domiciliaria')">Vista previa</button>
          <button class="btn secondary"
            onclick="downloadPDF(
              'Informe_Visita.pdf',
              'Informe de Visita',
              [
                'Evaluaci√≥n del entorno del adoptante',
                '',
                'El informe registra las condiciones observadas en el hogar del solicitante.',
                'Permite determinar si el espacio es adecuado y si cumple los requisitos b√°sicos de',
                'seguridad, bienestar y cuidados para el animal.',
                '',
                'Componentes del informe:',
                '‚Ä¢ Condiciones del hogar.',
                '‚Ä¢ Seguridad del entorno.',
                '‚Ä¢ Disponibilidad de tiempo y recursos.',
                '‚Ä¢ Impresiones generales del evaluador.',
                '',
                'Este documento respalda la decisi√≥n de aprobar o rechazar la adopci√≥n, bas√°ndose',
                'en criterios de bienestar animal.'
              ]
            )">
            Exportar PDF
          </button>
        </div>
      </div>

      <div class="card" style="grid-column:span 6;">
        <h3>Boleta / Comprobante Webpay</h3>
        <p class="muted">Se genera tras pago autorizado.</p>
        <div class="row">
          <button class="btn" onclick="previewDoc('Boleta / Comprobante Webpay')">Vista previa</button>
          <button class="btn secondary"
            onclick="downloadPDF(
              'Boleta_Webpay.pdf',
              'Boleta de compra',
              [
                'Folio: CA-000234',
                'Comprador: Nombre Apellido (RUT xx.xxx.xxx-x)',
                'Animal: Bonnie (Canina, 2 a√±os, microchip 12345)',
                '',
                'Detalle de cobro asociado al proceso de adopci√≥n o donaci√≥n realizado a trav√©s del sistema.',
                '',
                'Firmas:',
                'Comprador: ____________________',
                'Refugio: ______________________'
              ]
            )">
            Exportar PDF
          </button>
        </div>
      </div>

      <div class="card admin-only" style="grid-column:span 6;">
        <h3>Reportes de gesti√≥n (PDF/CSV)</h3>
        <p class="muted">KPI adopciones y donaciones.</p>
        <div class="row">
          <button class="btn" onclick="previewDoc('Reporte de gesti√≥n')">Vista previa</button>
          <button class="btn secondary"
            onclick="downloadPDF(
              'Reporte_Gestion.pdf',
              'Reporte de Gesti√≥n',
              [
                'Indicadores administrativos del refugio',
                '',
                'Estos reportes permiten a la administraci√≥n revisar cifras clave del funcionamiento',
                'del refugio. Facilitan evaluar resultados, medir la cantidad de adopciones realizadas,',
                'analizar la efectividad de campa√±as y apoyar la planificaci√≥n interna.',
                '',
                'Incluyen:',
                '‚Ä¢ Estad√≠sticas de adopciones.',
                '‚Ä¢ Movimientos de donaciones.',
                '‚Ä¢ Control de insumos o recursos.',
                '‚Ä¢ Comparaciones por per√≠odo.',
                '',
                'Los reportes sirven como base para la toma de decisiones y asignaci√≥n de recursos.'
              ]
            )">
            Exportar PDF
          </button>
        </div>
      </div>
    </div>
  </section>

  <footer>Prototipo educativo ¬∑ Bonnie SIRA ¬©</footer>
</div>

<!-- Modal documento -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="dialog">
    <header>
      <h3 id="modalTitle">Documento</h3>
      <button class="x" onclick="closeModal()">√ó</button>
    </header>
    <div id="modalBody" class="muted"></div>
    <div class="spacer"></div>
    <div class="row">
      <button class="btn secondary" onclick="closeModal()">Cerrar</button>
      <button class="btn secondary"
        onclick="downloadPDF(
          'Contrato_Adopcion.pdf',
          'Contrato de adopci√≥n',
          [
            'Este contrato informa y concientiza sobre la tenencia responsable de mascotas.',
            '',
            'Firmas:',
            'Adoptante: ______________________________',
            'Refugio Bonnie SIRA: ____________________'
          ]
        )">
        Exportar PDF
      </button>
    </div>
  </div>
</div>

<!-- Modal Webpay -->
<div id="webpay" class="modal" aria-hidden="true">
  <div class="dialog">
    <header>
      <h3>Webpay (Simulaci√≥n)</h3>
      <button class="x" onclick="closeWebpay()">√ó</button>
    </header>
    <p class="muted">Sandbox simulado. No procesa pagos reales.</p>
    <div class="grid">
      <div style="grid-column:span 6;">
        <label>N√∫mero de tarjeta</label>
        <input placeholder="xxxx xxxx xxxx xxxx"/>
      </div>
      <div style="grid-column:span 3;">
        <label>Expira</label>
        <input placeholder="mm/aa"/>
      </div>
      <div style="grid-column:span 3;">
        <label>CVV</label>
        <input placeholder="123"/>
      </div>
      <div style="grid-column:span 12;">
        <label>Nombre titular</label>
        <input placeholder="Titular demo"/>
      </div>
    </div>
    <div class="spacer"></div>
    <div class="row">
      <button class="btn secondary" onclick="confirmWebpay(false)">Cancelar</button>
      <button class="btn" onclick="confirmWebpay(true)">Autorizar pago</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
function login() {
  const role = document.getElementById("roleSelect").value;
  localStorage.setItem("userRole", role);

  document.getElementById("loginScreen").style.display = "none";
  aplicarRoles(role);
}

function aplicarRoles(role) {
   document.querySelectorAll(".admin-only")
    .forEach(e => e.style.display = (role === "admin" ? "block" : "none"));

   if (role === "adoptante") {
    document.querySelectorAll(".admin-only").forEach(e => e.style.display = "none");
  }
}

function logout() {
  localStorage.removeItem("userRole");
  document.getElementById("loginScreen").style.display = "flex";
}


window.onload = () => {
  const role = localStorage.getItem("userRole");
  if (role) {
    document.getElementById("loginScreen").style.display = "none";
    aplicarRoles(role);
  }
};  

const sections = ['home','entradas','tienda','carro','salidas'];

  function show(id){
    sections.forEach(s=>{
      document.getElementById(s).classList.toggle('hidden', s!==id);
      document.getElementById('tab-'+s).classList.toggle('active', s===id);
    });
    window.scrollTo({top:0,behavior:'smooth'});
  }

  // ----- ENTRADAS -----
  const entradas = [];

  function registrarEntrada(){
    const nombre = document.getElementById('inNombre').value.trim();
    const rut = document.getElementById('inRut').value.trim();
    const correo = document.getElementById('inCorreo').value.trim();
    const telefono = document.getElementById('inTelefono').value.trim();
    const animal = document.getElementById('inAnimalNombre').value.trim();
    const microchip = document.getElementById('inMicrochip').value.trim();
    const tipo = document.getElementById('inTipoSolicitud').value;
    const fecha = document.getElementById('inFecha').value;
    const obs = document.getElementById('inObs').value.trim();

    if(!nombre || !rut || !correo){
      alert('Nombre, RUT y correo son obligatorios.');
      return;
    }

    const entrada = {
      fechaRegistro: new Date().toLocaleString('es-CL'),
      nombre, rut, correo, telefono,
      animal, microchip, tipo, fecha, obs
    };

    entradas.push(entrada);
    actualizarEntradas();
    limpiarEntrada();
  }

  function limpiarEntrada(){
    document.getElementById('inNombre').value = '';
    document.getElementById('inRut').value = '';
    document.getElementById('inCorreo').value = '';
    document.getElementById('inTelefono').value = '';
    document.getElementById('inAnimalNombre').value = '';
    document.getElementById('inMicrochip').value = '';
    document.getElementById('inTipoSolicitud').value = 'adopcion';
    document.getElementById('inFecha').value = '';
    document.getElementById('inObs').value = '';
  }

  function actualizarEntradas(){
    if(entradas.length === 0){
      document.getElementById('entradaPreview').textContent = 'No hay registros a√∫n.';
      document.getElementById('tablaEntradas').innerHTML = '';
      return;
    }

    const ultima = entradas[entradas.length - 1];
    document.getElementById('entradaPreview').innerHTML = `
      <p><b>Fecha registro:</b> ${ultima.fechaRegistro}</p>
      <p><b>Adoptante:</b> ${ultima.nombre} (${ultima.rut})</p>
      <p><b>Correo:</b> ${ultima.correo}</p>
      <p><b>Animal:</b> ${ultima.animal || 'N/A'} ${ultima.microchip ? '(Chip: '+ultima.microchip+')' : ''}</p>
      <p><b>Tipo:</b> ${ultima.tipo}</p>
      <p><b>Fecha propuesta:</b> ${ultima.fecha || 'Sin definir'}</p>
      <p><b>Obs.:</b> ${ultima.obs || 'Sin observaciones'}</p>
    `;

    const tbody = document.getElementById('tablaEntradas');
    tbody.innerHTML = '';
    entradas.slice(-5).reverse().forEach(e=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${e.fechaRegistro}</td>
        <td>${e.nombre}</td>
        <td>${e.animal || 'N/A'}</td>
        <td>${e.tipo}</td>`;
      tbody.appendChild(tr);
    });
  }

  function downloadEntradasJSON(){
    if(entradas.length === 0){
      alert('No hay entradas registradas para exportar.');
      return;
    }
    const dataStr = JSON.stringify(entradas, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "entradas_adopcion.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ----- CARRO / TIENDA -----
  const cart = [];
  const badge = document.getElementById('badge');

  function money(n){
    return new Intl.NumberFormat('es-CL',{style:'currency',currency:'CLP'}).format(n);
  }

  function syncBadge(){
    badge.textContent = cart.reduce((a,i)=>a+i.qty,0);
  }

  function addItem(name, price){
    const it = cart.find(i=>i.name===name);
    it ? it.qty++ : cart.push({name, price, qty:1});
    renderCart(); syncBadge();
  }

  function addDemo(){
    addItem('Pack alimento 10kg', 24990);
    addItem('Aporte vacuna anual', 8000);
  }

  function removeItem(name){
    const idx = cart.findIndex(i=>i.name===name);
    if(idx>-1) cart.splice(idx,1);
    renderCart(); syncBadge();
  }

  function changeQty(name, q){
    const it = cart.find(i=>i.name===name); if(!it) return;
    it.qty = Math.max(1, parseInt(q||'1',10));
    renderCart(); syncBadge();
  }

  function clearCart(){
    cart.splice(0, cart.length);
    renderCart(); syncBadge();
  }

  function renderCart(){
    const tbody = document.querySelector('#cartTable tbody');
    tbody.innerHTML = '';
    let sub = 0;
    cart.forEach(it=>{
      const st = it.price*it.qty; sub += st;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${it.name}</td>
        <td class="right">${money(it.price)}</td>
        <td class="right"><input type="number" min="1" value="${it.qty}" style="width:70px" onchange="changeQty('${it.name}', this.value)"></td>
        <td class="right">${money(st)}</td>
        <td class="right"><button class="btn secondary small" onclick="removeItem('${it.name}')">Quitar</button></td>`;
      tbody.appendChild(tr);
    });
    const tax = Math.round(sub*0.19);
    const total = sub+tax;
    document.getElementById('subtotal').textContent = money(sub);
    document.getElementById('tax').textContent = money(tax);
    document.getElementById('total').innerHTML = `<strong>${money(total)}</strong>`;
  }

  // ----- DOCS / WEBPAY -----
  function previewDoc(title){
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = `
      <p><b>${title}</b> (mock).</p>`;
    document.getElementById('modal').style.display='flex';
  }

  function closeModal(){
    document.getElementById('modal').style.display='none';
  }

  function downloadPDF(fileName, title, bodyLines = []) {
    if (!window.jspdf || !window.jspdf.jsPDF) {
      alert("No se carg√≥ jsPDF. Revisa tu conexi√≥n o el link CDN.");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text("Bonnie SIRA ‚Äî Refugio & Adopciones", 14, 18);

    doc.setFontSize(12);
    doc.setFont("helvetica", "normal");
    doc.text(title, 14, 30);

    const now = new Date();
    doc.setFontSize(10);
    doc.text(`Fecha emisi√≥n: ${now.toLocaleString("es-CL")}`, 14, 38);

    let y = 50;
    doc.setFontSize(11);

    if (bodyLines.length === 0) {
      bodyLines = ["Documento generado por prototipo educativo."];
    }

    bodyLines.forEach(line => {
      doc.text(line, 14, y);
      y += 7;
      if (y > 280) { doc.addPage(); y = 20; }
    });

    doc.save(fileName);
  }

  function openWebpay(){
    if(cart.length===0){ alert('Tu carro est√° vac√≠o.'); return; }
    const name = document.getElementById('buyerName').value.trim();
    const email = document.getElementById('buyerEmail').value.trim();
    if(!name || !email){ alert('Completa Nombre y Email para continuar.'); return; }
    document.getElementById('webpay').style.display='flex';
  }

  function closeWebpay(){
    document.getElementById('webpay').style.display='none';
  }

  function confirmWebpay(ok){
    closeWebpay();
    if(ok){
      alert('Pago autorizado (simulaci√≥n). Se gener√≥ Boleta/Comprobante.');
      downloadPDF(
        "Boleta_Webpay.pdf",
        "Boleta / Comprobante Webpay",
        [
          "Orden: WB-552199",
          "Tipo: " + document.getElementById("purchaseType").value,
          "Comprador: " + document.getElementById("buyerName").value,
          "Email: " + document.getElementById("buyerEmail").value,
          "",
          "Detalle:",
          ...cart.map(i => `‚Ä¢ ${i.qty} x ${i.name} ‚Äî ${money(i.price * i.qty)}`),
          "",
          "Total pagado: " + document.getElementById("total").innerText,
          "Estado: AUTHORIZED"
        ]
      );
      clearCart();
    }else{
      alert('Pago cancelado (simulaci√≥n).');
    }
  }

  renderCart(); syncBadge(); actualizarEntradas();
</script>

</body>
</html>
